version: '2'
services:
  postgres:
    restart: always
    image: kiasaki/alpine-postgres:9.5
    environment:
      - POSTGRES_USER:'postgres'
      - POSTGRES_PASSWORD:'postgres'
      - POSTGRES_DB:'test'
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - '5432:5432'
  app:
    build: ./
    environment:
      - NODE_ENV=test
  integration-tests:
    image: dronestarter_ds-api
    command: npm run test:integration
    depends_on:
      - postgres
      - app
